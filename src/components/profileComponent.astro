---
import SectionContainer from "@/components/sectionContainer.astro";
import ShareIcon from "@/components/icons/shareIcon.astro";
import GitHubIcon from "@/components/icons/brands/githubIcon.astro";
import Share2Icon from "@/components/icons/share2Icon.astro";
import XLetterIcon from "@/components/icons/xLetterIcon.astro";

interface Props {
    name: string;
    username: string;
    img: string;
    link: string;
    certificates?: {
        title: string;
        description: string;
        img: {
            src: string;
            alt: string;
        }
    }[];
    main?: boolean;
}
const { name, username, img, link, certificates, main = false } = Astro.props;
---
<SectionContainer class="md:flex md:gap-x-8">
    <div class="flex md:flex-col justify-around md:items-start items-end md:gap-y-2">
        <div
        style={{ backgroundImage: `url(${img})` }}
        class="aspect-square w-44 md:w-72 bg-center bg-cover bg-no-repeat rounded-lg bg-white"
        />
        {
            main && (
                <form
                action="/api/auth/signout"
                class="lg:w-full"
                >
                    <button
                    class="py-2 px-3 bg-secondary hover:bg-buttonHov font-bold rounded-lg lg:w-full transition ease-in-out duration-300"
                    type="submit"
                    >
                        Cerrar sesion
                    </button>
                </form>
            )
        }
    </div>
    <div class="md:flex md:flex-col md:justify-center md:gap-y-2">
        <div class="flex items-center gap-x-3 md:gap-x-4 pt-4">
            <h1 class="font-bold text-3xl md:text-[4rem] leading-[1.2]">
                {name}
            </h1>
            {
                main && (
                    <button
                    id="share-button"
                    class="p-2 bg-[#1E1E1E] rounded-lg bg-opacity-0 hover:bg-opacity-100 hover:scale-105 active:scale-95 transition"
                    >
                        <ShareIcon />
                    </button>
                )
            }
        </div>
        <a href={link ?? ""} target="_blank" class="flex w-fit opacity-50 items-center font-medium md:hover:bg-buttonHov rounded-2xl md:px-3 py-2 transition duration-300 ease-in-out">
            <GitHubIcon width="30" />
            <p class="pl-3 md:pl-3 font-semibold text-xl md:text-2xl">
                {username}
            </p>
        </a>
    </div>
</SectionContainer>
<SectionContainer class="border-opacity-50 border-t-[1px] border-t-yellow-300 mt-5">
    <h2 class="text-2xl text-yellow-200 font-bold text-center pb-3 pt-4">
        Certificados
    </h2>
    <ul class="flex flex-col gap-y-2 md:grid md:grid-cols-2 md:gap-3 lg:grid-cols-3 lg:gap-4 2xl:grid-cols-4 2xl:gap-5">
        {
            certificates && certificates?.length > 0 ? certificates.map(certificate => (
                <li>
                    <div
                    class="flex justify-end items-end p-3 aspect-video w-full rounded-xl bg-secondary"
                    >
                        <Share2Icon width="30" />
                    </div>
                </li>
            ))
            :
            <li>
                <div
                class="flex justify-center items-center text-red-300 p-3 aspect-video w-full rounded-xl bg-secondary"
                >
                    <p class="pr-5 font-medium text-xl">No tienes certificados</p>
                    <XLetterIcon width="30" />
                </div>
            </li>
        }
    </ul>
</SectionContainer>

<script is:inline define:vars={{ username }}>
    const shareButton = document.querySelector("#share-button");

    shareButton?.addEventListener("click", async () => {
        if (navigator.share) {
            await navigator.share({
                title: "Mi perfil de CodeProject",
                text: `\
ðŸš€ Â¡Hola! ðŸ‘‹

Si te apasiona el mundo de la programaciÃ³n, no puedes perderte de CodeProject ðŸŒŸ. AhÃ­ encontrarÃ¡s proyectos increÃ­bles de desarrolladores como tÃº, con ideas innovadoras y cÃ³digo impresionante ðŸ”¥.

ðŸ” Explora mi perfil y mira lo que estoy haciendo! ðŸ’»âœ¨

ðŸ‘‰ `,
                url: `https://www.codeproject.site/profile/${username ?? ""}`,
            })
            .then(() => console.log("Successful share"))
            .catch((error) => console.log("Error sharing", error));
        }
    });
</script>
