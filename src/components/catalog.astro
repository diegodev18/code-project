---
import SearchVar from "@/components/searchVar.astro";
import CategoriesGallery from "@/components/categoriesGallery.astro";
import ProjectsGallery from "@/components/projectsGallery.astro";
import getProgress from "@/utils/getProgressProjects";
import getSession from "@/utils/getSession";
import { allProjects } from "@/utils/getAllProjects";

const session = await getSession(Astro);
const uuid = session?.id;

const user_progress = await getProgress(uuid || "");
---

<SearchVar />
<CategoriesGallery />
<ProjectsGallery id="main" cards={[...(allProjects ?? [])]} uuid={uuid} />
<ProjectsGallery
  id="love"
  title="Podrian gustarte"
  cards={[...(allProjects ?? [])]}
  small={false}
  uuid={uuid}
/>
{
  user_progress && user_progress?.length != 0 && (
    <ProjectsGallery
      id="continue"
      title="Seguir aprendiendo"
      cards={[...(user_progress ?? [])].filter(
        (item): item is NonNullable<typeof item> => item !== undefined,
      )}
      uuid={uuid}
    />
  )
}
