---
import SearchVar from "@/components/searchVar.astro";
import CategoriesGallery from "@/components/categoriesGallery.astro";
import ProjectsGallery from "@/components/projectsGallery.astro";
import getProjects from "@/lib/getProjects";
import getProgress from "@/utils/getProgressProjects";
import getFavorites from "@/utils/getFavorites";
import getSession from "@/utils/getSession";

const session = await getSession(Astro);

const Projects = await getProjects();
const user_progress = getProgress(session?.user_metadata.user_name || "");
const user_fav = getFavorites(session?.user_metadata.user_name || "");

console.log(Projects);
---

<SearchVar />
<CategoriesGallery />
<ProjectsGallery
id="main"
cards={[...(Projects ?? [])]}
session={true}
/>
<ProjectsGallery
id="love"
title="Podrian gustarte"
cards={[...(Projects ?? [])]}
small={false}
session={true}
/>
{
    user_progress && user_progress?.length != 0 && (
        <ProjectsGallery
        id="continue"
        title="Seguir aprendiendo"
        cards={[...(user_progress ?? [])].filter((item): item is NonNullable<typeof item> => item !== undefined)}
        session={true}
        />
    )
}
<ProjectsGallery
id="fav"
title="Favoritos"
cards={[...(user_fav ?? [])].filter((item): item is NonNullable<typeof item> => item !== undefined)}
session={true}
/>