---
import SearchVar from "@/components/searchVar.astro";
import CategoriesGallery from "@/components/categoriesGallery.astro";
import ProjectsGallery from "@/components/projectsGallery.astro";
import Projects from "@/db/projects";
import getProgress from "@/utils/getProgressProjects";
import getFavorites from "@/utils/getFavorites";
import { getSession } from "auth-astro/server";

const session = await getSession(Astro.request);
const user_progress = getProgress(session?.user?.email || "");
const user_fav = getFavorites(session?.user?.email || "");
---

<SearchVar />
<CategoriesGallery />
<ProjectsGallery
id="main"
cards={[...Projects]}
session={true}
/>
<ProjectsGallery
id="love"
title="Podrian gustarte"
cards={[...Projects]}
small={false}
session={true}
/>
{
    user_progress?.length != 0 && (
        <ProjectsGallery
        id="continue"
        title="Seguir aprendiendo"
        cards={[...(user_progress ?? [])].filter((item): item is NonNullable<typeof item> => item !== undefined)}
        session={true}
        />
    )
}
<ProjectsGallery
id="fav"
title="Favoritos"
cards={[...(user_fav ?? [])].filter((item): item is NonNullable<typeof item> => item !== undefined)}
session={true}
/>