---
import getProgressFromAProject from "@/utils/getProgressFromAProject";
import getProjectsList from "@/utils/getDBProjectsList";

interface Props {
  id: string;
  href: string;
  title: string;
  description: string;
  icon: {
    width: number;
    height: number;
    component: any;
  };
  uuid?: string | null;
}
const {
  id,
  href,
  title,
  description,
  icon: { width, height, component: Icon },
  uuid = null,
} = Astro.props;

const { progress, percentaje, lenguage } = await getProgressFromAProject(
  id,
  uuid,
);

const projectsList = await getProjectsList(id, lenguage);

const projectFound =
  projectsList[0] != "403"
    ? projectsList.find((item: string) => {
        const num = parseInt(item.slice(0, 3));
        if (num === progress) {
          return item;
        }
      })
    : "001-index.md";
---

<li class="mt-5 md:mt-2 lg:mt-3 snap-center">
  <a
    class="group w-[140px] md:w-[175px] lg:w-[210px] aspect-[9/10] hover:bg-button-hov bg-dark-secondary rounded-lg flex flex-col justify-center items-center relative transition duration-300 ease-in-out"
    title={`${title} - ${description}`}
    href={uuid
      ? progress === 0
        ? href
        : `${href}/${lenguage}/${(projectFound || "")?.replace(".md", "")}`
      : "/profile"}
  >
    <div
      class="absolute -top-6 md:-top-2 lg:-top-4 md:group-hover:scale-105 md:group-hover:pb-16 transition"
    >
      <Icon width={width} height={height} />
    </div>
    <div
      class="pt-16 md:pt-20 lg:pt-[4.5rem] pb-3 px-3 z-10 flex flex-col justify-between h-full"
    >
      <h3
        class="font-semibold leading-5 md: md:text-xl line-clamp-3 lg:line-clamp-2 md:group-hover:text-yellow-300 transition"
      >
        {title}
      </h3>
      <p
        class="hidden lg:block font-medium opacity-65 group-hover:opacity-100 leading-5 transition"
      >
        {description}
      </p>
      <div class="relative w-full h-3 bg-white rounded-full mt-2">
        <div
          class="absolute bg-[#313131] md:group-hover:bg-[#363636] transition h-full rounded-full"
          style={`width: ${percentaje}%`}
        >
        </div>
      </div>
    </div>
  </a>
</li>
