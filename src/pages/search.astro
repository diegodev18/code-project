---
import GitIcon from '@/components/icons/brands/gitIcon.astro';
import SearchCard from '@/components/searchCard.astro';
import SearchVar from '@/components/searchVar.astro'
import SectionContainer from '@/components/sectionContainer.astro';
import Projects from '@/db/projects';
import Layout from '@/layouts/Layout.astro'
import getIcon from '@/utils/getIcon';

const searched = Astro.url.searchParams.get('search') ?? "Todos";

let found = [];
if (searched == "Todos") {
    found = Projects;
} else {
    found = Projects.filter(project => {
        return project.title.toLowerCase().includes(searched.toLowerCase());
    });
}
---

<Layout
title='Search'
description='Search for products'
>
    <SearchVar />
    <SectionContainer>
        <p class="pt-2 pb-4 font-medium">
            <span class="opacity-70 italic text-sm">
                Resultados para:
            </span>
            <span class="font-bold text-purple-300">
                {searched}
            </span>
        </p>
    </SectionContainer>
    {
        found.length > 0 && (
            <SectionContainer class="grid grid-cols-1 gap-y-8 lg:grid-cols-2 2xl:grid-cols-3 min-h-[70vh] md:min-h-[78vh]">
                {
                    found.map(project => {
                        const { width, height, component: Icon } = getIcon(project.icon);
                        return (
                            <SearchCard title={project.title} description={project.description} href={project.href} icon={{ width: width + 100, height: height + 100, component: Icon }} />
                        )
                    })
                }
            </SectionContainer>
        )
    }
    {
        found.length === 0 && (
            <SectionContainer class="flex items-center justify-center h-[70vh] md:h-[78vh]">
                <p class="text-2xl text-center font-bold text-purple-300">
                    No se encontraron resultados
                </p>
            </SectionContainer>
        )
    }
</Layout>