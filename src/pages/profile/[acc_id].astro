---
import Layout from "@/layouts/Layout.astro";
import ProfileComponent from "@/components/profileComponent.astro";
import Adv from "@/components/adv.astro";
import { supabase } from "@/lib/supabase";

const params = Astro.params;

let { data: session } = await supabase
    .from("users")
    .select("user_name, full_name, avatar_url, certificates")
    .eq("user_name", params.acc_id)
    .single();
---
<Layout
title={session?.full_name ?? "Profile - CodeProject"}
description={`Pagina de perfil de ${session?.full_name ?? "CodeProject"}`}
>
    {
        session ?
        <ProfileComponent
        name={session?.full_name ?? "Cool name"}
        username={session?.user_name ?? "Cool username"}
        img={session?.avatar_url ?? ""}
        link={session?.user_name ? `https://github.com/${session?.user_name}` : "https://github.com/"}
        certificates={session.certificates ?? []}
        />
        :
        <Adv title="404 - Perfil no encontrado" description="No se ha encontrado el perfil :(. Revisa que la url este correcta!" />
    }
</Layout>
